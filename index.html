<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Z' D√ñV - Business Empire</title>
    <style>
        body {
            background-color: #111;
            color: white;
            font-family: "Courier New", Courier, monospace;
            text-align: center;
            margin: 0;
            padding: 10px;
            overflow: hidden;
            user-select: none;
            -webkit-user-select: none;
            touch-action: manipulation;
            transition: background-color 1s ease;
        }

        h1 { 
            color: #ff4757; 
            margin: 0; 
            font-size: 2.2rem; 
            text-transform: uppercase; 
            letter-spacing: 2px;
            text-shadow: 0 0 10px rgba(255, 71, 87, 0.5);
        }
        
        .level-badge {
            background: #ff4757;
            color: white;
            padding: 2px 8px;
            border-radius: 5px;
            font-size: 0.8rem;
            vertical-align: middle;
        }

        /* Save Icon */
        #save-notify {
            position: absolute;
            top: 10px; right: 10px;
            font-size: 0.8rem;
            color: #2ed573;
            opacity: 0;
            transition: opacity 0.5s;
        }

        /* Stats Zeile */
        .stats-bar {
            background: rgba(255,255,255,0.1);
            padding: 8px;
            margin-top: 10px;
            border-radius: 10px;
            display: flex;
            justify-content: space-around;
            font-size: 0.9rem;
            backdrop-filter: blur(5px);
            border: 1px solid rgba(255,255,255,0.2);
        }
        
        .money { color: gold; font-weight: bold; font-size: 1.1rem; }

        /* Arena */
        .arena {
            height: 230px;
            display: flex;
            justify-content: center;
            align-items: center;
            position: relative;
            margin-top: 10px;
        }

        #face {
            font-size: 130px;
            cursor: pointer;
            transition: transform 0.05s;
            z-index: 10;
            filter: drop-shadow(0 0 20px rgba(255,255,255,0.1));
            position: relative;
        }

        #face:active { transform: scale(0.9); }

        /* Waffe Animation */
        #weapon-anim {
            position: absolute;
            font-size: 80px;
            opacity: 0;
            pointer-events: none;
            z-index: 11;
            transition: all 0.1s;
        }

        .smash-anim {
            opacity: 1 !important;
            transform: scale(1.2) rotate(-45deg) !important;
            left: 55% !important; 
        }

        /* Partikel */
        .particle {
            position: absolute;
            pointer-events: none;
            background: cyan;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            z-index: 99;
            animation: fly 0.6s linear forwards;
        }
        @keyframes fly {
            0% { transform: translate(0,0) scale(1); opacity: 1; }
            100% { transform: translate(var(--tx), var(--ty)) scale(0); opacity: 0; }
        }

        /* Animationen */
        .hit { color: #ff4757; transform: rotate(15deg) scale(0.95); }
        .dead { filter: grayscale(100%); opacity: 0.5; transform: rotate(180deg); pointer-events: none; }

        /* Balken */
        .bar-container {
            width: 90%;
            height: 20px;
            border: 2px solid rgba(255,255,255,0.5);
            margin: 0 auto;
            position: relative;
            background: rgba(0,0,0,0.5);
            border-radius: 15px;
            overflow: hidden;
        }

        .bar-fill {
            height: 100%;
            background: linear-gradient(90deg, #ff4757, #ff6b81);
            width: 100%;
            transition: width 0.1s;
        }

        /* SHOP & TABS */
        .shop-area {
            margin-top: 10px;
            padding-top: 5px;
            background: rgba(0,0,0,0.3);
            border-radius: 20px 20px 0 0;
            padding-bottom: 50px;
            height: 300px;
            overflow-y: auto;
        }

        .tab-buttons {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-bottom: 10px;
        }
        
        .tab-btn {
            background: none;
            border: 1px solid #555;
            color: #888;
            padding: 5px 15px;
            border-radius: 20px;
            cursor: pointer;
        }
        .tab-btn.active {
            background: white;
            color: black;
            border-color: white;
            font-weight: bold;
        }

        .shop-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
            max-width: 400px;
            margin: 0 auto;
            padding: 0 10px;
        }

        .shop-btn {
            background: #2f3542;
            color: #ccc;
            border: 1px solid #57606f;
            padding: 8px;
            border-radius: 8px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: flex-start;
            gap: 10px;
            transition: 0.2s;
            text-align: left;
            position: relative;
        }

        .shop-btn .icon { font-size: 1.8rem; }
        .shop-btn div { display: flex; flex-direction: column; }
        .shop-btn h4 { margin: 0; font-size: 0.9rem; }
        .shop-btn small { font-size: 0.75rem; color: #a4b0be; }
        
        /* Z√§hler f√ºr Anzahl der Mitarbeiter */
        .count-badge {
            position: absolute;
            top: -5px; right: -5px;
            background: #2ed573;
            color: black;
            border-radius: 50%;
            width: 20px; height: 20px;
            font-size: 0.7rem;
            display: flex; align-items: center; justify-content: center;
            font-weight: bold;
        }

        .shop-btn.owned { border-color: gold; color: white; background: #2f3542; }
        .shop-btn.active { background: linear-gradient(45deg, gold, orange); color: black; border-color: white; }
        
        #msg { min-height: 20px; color: yellow; margin: 5px 0; font-weight: bold; font-size: 0.9rem;}

        #reset-btn {
            position: absolute;
            top: 50%; left: 50%;
            transform: translate(-50%, -50%);
            padding: 15px 30px;
            font-size: 1.2rem;
            background: #2ed573;
            border: none;
            color: white;
            border-radius: 50px;
            cursor: pointer;
            box-shadow: 0 0 20px rgba(46, 213, 115, 0.6);
            z-index: 20;
            white-space: nowrap;
        }
        .hidden { display: none; }

    </style>
</head>
<body>

    <div id="save-notify">üíæ Gespeichert</div>

    <h1>Z' D√ñV <span class="level-badge" id="lvl-badge">LVL 1</span></h1>
    
    <div class="stats-bar">
        <span>Oguz HP: <b id="hp-val">100</b></span>
        <span class="money"><span id="money-val">0</span> ‚Ç¨</span>
    </div>

    <div class="bar-container">
        <div id="health" class="bar-fill"></div>
    </div>
    
    <p id="msg">Gesch√§ft er√∂ffnet!</p>

    <div class="arena">
        <div id="weapon-anim">üëä</div>
        
        <div id="face" onclick="manualAttack(event)">üë®‚Äçü¶≤</div>
        
        <button id="reset-btn" class="hidden" onclick="nextLevel()">N√ÑCHSTES LEVEL >>></button>
    </div>

    <div class="shop-area">
        <div class="tab-buttons">
            <button class="tab-btn active" onclick="showTab('weapons')">‚öîÔ∏è Waffen</button>
            <button class="tab-btn" onclick="showTab('staff')">üë• Mitarbeiter</button>
        </div>

        <div id="tab-weapons" class="shop-grid">
            <button id="w-fist" class="shop-btn active" onclick="equip('fist')">
                <span class="icon">üëä</span>
                <div><h4>Kerenin yumrugu</h4><small>Gratis</small></div>
            </button>
            <button id="w-slipper" class="shop-btn" onclick="buyWeapon('slipper', 50)">
                <span class="icon">ü©¥</span>
                <div><h4>Terlik</h4><small>50 ‚Ç¨</small></div>
            </button>
            <button id="w-pan" class="shop-btn" onclick="buyWeapon('pan', 250)">
                <span class="icon">üç≥</span>
                <div><h4>Pfanne</h4><small>250 ‚Ç¨</small></div>
            </button>
            <button id="w-hammer" class="shop-btn" onclick="buyWeapon('hammer', 600)">
                <span class="icon">üî®</span>
                <div><h4>Hammer</h4><small>600 ‚Ç¨</small></div>
            </button>
             <button id="w-bat" class="shop-btn" onclick="buyWeapon('bat', 1500)">
                <span class="icon">üèè</span>
                <div><h4>Keule</h4><small>1500 ‚Ç¨</small></div>
            </button>
            <button id="w-fart" class="shop-btn" onclick="buyWeapon('fart', 5000)">
                <span class="icon">‚ò£Ô∏è</span>
                <div><h4>Sakirden uppercut</h4><small>5000 ‚Ç¨</small></div>
            </button>
        </div>

        <div id="tab-staff" class="shop-grid hidden">
            <button class="shop-btn" onclick="hireStaff('kuseng', 100)">
                <span class="icon">üß¢</span>
                <div><h4>Lion</h4><small>100 ‚Ç¨ (1/s)</small></div>
                <div id="cnt-kuseng" class="count-badge hidden">0</div>
            </button>
            <button class="shop-btn" onclick="hireStaff('brudi', 500)">
                <span class="icon">üï∂Ô∏è</span>
                <div><h4>Lion</h4><small>500 ‚Ç¨ (5/s)</small></div>
                <div id="cnt-brudi" class="count-badge hidden">0</div>
            </button>
             <button class="shop-btn" onclick="hireStaff('gang', 2000)">
                <span class="icon">üöê</span>
                <div><h4>Haji Han</h4><small>2k ‚Ç¨ (25/s)</small></div>
                <div id="cnt-gang" class="count-badge hidden">0</div>
            </button>
        </div>
    </div>

    <script>
        // --- GAME STATE ---
        let state = {
            level: 1,
            maxHp: 100,
            hp: 100,
            money: 0,
            inventory: ['fist'],
            currentWeapon: 'fist',
            staff: {
                Champ: 0, // Anzahl Kusengs
                Lion: 0,
                Haji Han: 0
            }
        };

        let isDead = false;

        // Waffen Daten (Konstanten)
        const weapons = {
            'fist':    { dmg: [5, 9],    icon: 'üëä', name: 'Keremin yumrugu' },
            'slipper': { dmg: [15, 25],  icon: 'ü©¥', name: 'Terlik' },
            'pan':     { dmg: [35, 55],  icon: 'üç≥', name: 'Pfanne' },
            'hammer':  { dmg: [70, 100], icon: 'üî®', name: 'Hammer' },
            'bat':     { dmg: [150, 250], icon: 'üèè', name: 'Keule' },
            'fart':    { dmg: [500, 999], icon: '‚ò£Ô∏è', name: 'Sakirden uppercut' }
        };

        // Staff Daten
        const staffData = {
            'Champ': { dps: 1, name: "Champ" },
            'Lion':  { dps: 5, name: "Lion" },
            'Haji Han':   { dps: 25, name: "Haji Han" }
        };

        // Elemente
        const face = document.getElementById('face');
        const hpBar = document.getElementById('health');
        const hpVal = document.getElementById('hp-val');
        const moneyEl = document.getElementById('money-val');
        const msg = document.getElementById('msg');
        const weaponAnim = document.getElementById('weapon-anim');
        const resetBtn = document.getElementById('reset-btn');
        const lvlBadge = document.getElementById('lvl-badge');
        const saveNotify = document.getElementById('save-notify');

        // --- INIT ---
        loadGame(); // Spielstand laden beim Start
        updateUI();
        updateShopUI();
        
        // Auto-D√∂v Loop (Jede Sekunde)
        setInterval(autoAttack, 1000);
        // Auto-Save Loop (Alle 5 Sekunden)
        setInterval(saveGame, 5000);

        // --- ATTACK SYSTEM ---
        function manualAttack(e) {
            if (isDead) return;
            // Bei manuellem Klick: Mouse Position f√ºr Partikel nutzen
            attackLogic(true, e.clientX, e.clientY);
        }

        function autoAttack() {
            if (isDead) return;
            
            // Berechne Gesamt-DPS der Mitarbeiter
            let totalDps = (state.staff.kuseng * staffData.kuseng.dps) + 
                           (state.staff.brudi * staffData.brudi.dps) + 
                           (state.staff.gang * staffData.gang.dps);
            
            if (totalDps > 0) {
                // Zuf√§llige Position auf dem Gesicht f√ºr Auto-Partikel
                const rect = face.getBoundingClientRect();
                const randX = rect.left + rect.width/2 + (Math.random()-0.5)*50;
                const randY = rect.top + rect.height/2 + (Math.random()-0.5)*50;

                attackLogic(false, randX, randY, totalDps);
            }
        }

        function attackLogic(isManual, x, y, autoDmg = 0) {
            let dmg = 0;
            let currentW = weapons[state.currentWeapon];

            if (isManual) {
                // Waffen Schaden
                dmg = Math.floor(Math.random() * (currentW.dmg[1] - currentW.dmg[0] + 1)) + currentW.dmg[0];
                
                // Crit Chance nur bei manuellem Klick
                if (Math.random() < 0.15) {
                    dmg = Math.floor(dmg * 2);
                    spawnParticles(x, y, 10, 'red');
                    msg.innerText = "üí• HELAL! " + dmg;
                    msg.style.color = "red";
                    if (navigator.vibrate) navigator.vibrate(50);
                } else {
                    spawnParticles(x, y, 4, 'cyan');
                    msg.innerText = "-" + dmg;
                    msg.style.color = "yellow";
                }
                
                // Waffen Animation nur bei manuellem Klick
                animateWeapon(currentW.icon);
                
                // Geld pro Schlag
                state.money += Math.floor(Math.random() * 3) + state.level;
            } else {
                // Auto Schaden
                dmg = autoDmg;
                // Kleiner visueller Effekt auch bei Auto
                spawnParticles(x, y, 1, 'lime'); 
            }

            state.hp -= dmg;
            if (state.hp < 0) state.hp = 0;

            updateUI();
            updateFaceState();

            if (state.hp <= 0) {
                kill();
            }
        }

        function animateWeapon(icon) {
            weaponAnim.innerText = icon;
            weaponAnim.style.left = "60%"; 
            weaponAnim.style.top = "20%";
            setTimeout(() => { weaponAnim.classList.add("smash-anim"); }, 10);
            
            face.classList.add("hit");
            setTimeout(() => {
                face.classList.remove("hit");
                weaponAnim.classList.remove("smash-anim");
                weaponAnim.style.opacity = "0";
            }, 150);
        }

        function updateFaceState() {
            let hpPercent = (state.hp / state.maxHp) * 100;
            if (state.hp > 0) {
                if (hpPercent < 30) face.innerText = "ü§¢";
                else if (hpPercent < 60) face.innerText = "ü§ï";
                else face.innerText = "üò†";
            }
        }

        function kill() {
            isDead = true;
            face.innerText = "üòµ";
            face.classList.add("dead");
            
            let bonus = 50 * state.level;
            state.money += bonus;
            
            msg.innerText = "K.O.! + " + bonus + " ‚Ç¨";
            msg.style.color = "#2ed573";
            
            resetBtn.classList.remove("hidden");
            if (navigator.vibrate) navigator.vibrate([100,50,100]);
            
            updateUI();
            saveGame(); // Sofort speichern bei Kill
        }

        function nextLevel() {
            state.level++;
            state.maxHp = Math.floor(state.maxHp * 1.4);
            state.hp = state.maxHp;
            isDead = false;
            
            face.innerText = "üë®‚Äçü¶≤";
            face.classList.remove("dead");
            resetBtn.classList.add("hidden");
            msg.innerText = "Z geri geldi kelek!!!!";
            msg.style.color = "white";
            
            updateUI();
            saveGame();
        }

        // --- SHOP FUNCTIONS ---
        function buyWeapon(key, price) {
            if (state.inventory.includes(key)) {
                equip(key);
                return;
            }
            if (state.money >= price) {
                state.money -= price;
                state.inventory.push(key);
                equip(key);
                msg.innerText = "Gekauft: " + weapons[key].name;
            } else {
                msg.innerText = "Fehlt: " + (price - state.money) + " ‚Ç¨";
                msg.style.color = "orange";
            }
            updateUI();
            updateShopUI();
        }

        function hireStaff(type, price) {
            // Staff wird jedes Mal teurer (Preis * 1.2 ^ Anzahl)
            let currentCount = state.staff[type];
            let realPrice = Math.floor(price * Math.pow(1.2, currentCount));

            if (state.money >= realPrice) {
                state.money -= realPrice;
                state.staff[type]++;
                msg.innerText = "Eingestellt: " + staffData[type].name;
                updateUI();
                updateShopUI(); // Wichtig um Preis zu aktualisieren
            } else {
                msg.innerText = "Fehlt: " + (realPrice - state.money) + " ‚Ç¨";
                msg.style.color = "orange";
            }
        }

        function equip(key) {
            state.currentWeapon = key;
            msg.innerText = "Ausr√ºstung: " + weapons[key].name;
            updateShopUI();
        }

        // --- UI & TABS ---
        function showTab(tabName) {
            document.getElementById('tab-weapons').classList.add('hidden');
            document.getElementById('tab-staff').classList.add('hidden');
            
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            
            if (tabName === 'weapons') {
                document.getElementById('tab-weapons').classList.remove('hidden');
                document.querySelector('button[onclick="showTab(\'weapons\')"]').classList.add('active');
            } else {
                document.getElementById('tab-staff').classList.remove('hidden');
                document.querySelector('button[onclick="showTab(\'staff\')"]').classList.add('active');
            }
        }

        function updateUI() {
            moneyEl.innerText = state.money;
            let hpPercent = (state.hp / state.maxHp) * 100;
            hpBar.style.width = hpPercent + "%";
            hpVal.innerText = state.hp + " / " + state.maxHp;
            lvlBadge.innerText = "LVL " + state.level;
            
            // Hintergrund dunkler je Level
            let r = Math.max(17 - (state.level), 0);
            document.body.style.backgroundColor = `rgb(${r}, ${r}, ${r})`;
        }

        function updateShopUI() {
            // Waffen Update
            document.querySelectorAll('#tab-weapons .shop-btn').forEach(btn => {
                btn.classList.remove('active');
                btn.classList.remove('owned');
            });
            
            // Inventar pr√ºfen
            state.inventory.forEach(key => {
                let btn = document.getElementById('w-' + key);
                if(btn) {
                    btn.classList.add('owned');
                    btn.querySelector('small').innerText = "Im Besitz";
                }
            });
            
            // Aktive Waffe
            let activeBtn = document.getElementById('w-' + state.currentWeapon);
            if(activeBtn) activeBtn.classList.add('active');

            // Staff Badges und Preise Update
            for (let type in state.staff) {
                let count = state.staff[type];
                let badge = document.getElementById('cnt-' + type);
                if(count > 0) {
                    badge.innerText = count;
                    badge.classList.remove('hidden');
                }
                // Preisanzeige aktualisieren w√§re cool, aber f√ºr diesen simplen Code lassen wir es statisch oder berechnen es beim Klick.
            }
        }

        // --- PARTICLES ---
        function spawnParticles(x, y, count, color) {
            for (let i = 0; i < count; i++) {
                let p = document.createElement('div');
                p.classList.add('particle');
                p.style.backgroundColor = color;
                p.style.left = x + 'px';
                p.style.top = y + 'px';
                let tx = (Math.random() - 0.5) * 150;
                let ty = (Math.random() - 0.5) * 150;
                p.style.setProperty('--tx', tx + 'px');
                p.style.setProperty('--ty', ty + 'px');
                document.body.appendChild(p);
                setTimeout(() => p.remove(), 600);
            }
        }

        // --- SAVE / LOAD ---
        function saveGame() {
            localStorage.setItem('zDovSave', JSON.stringify(state));
            
            // Kleines "Gespeichert" Feedback
            saveNotify.style.opacity = 1;
            setTimeout(() => { saveNotify.style.opacity = 0; }, 1000);
        }

        function loadGame() {
            let saved = localStorage.getItem('zDovSave');
            if (saved) {
                try {
                    let parsed = JSON.parse(saved);
                    // Merge mit Default State falls neue Felder dazu kamen
                    state = { ...state, ...parsed };
                    
                    // Sicherstellen dass HP nicht buggt
                    if(state.hp <= 0) state.hp = 1; 
                } catch(e) {
                    console.log("Savegame fehlerhaft");
                }
            }
        }

    </script>
</body>
</html>
