<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Z' D√ñV - FINAL</title>
    <style>
        /* --- DEIN CSS (Eingef√ºgt) --- */
        :root {
            --bg: #121212;
            --card: #1e1e24;
            --text: #ffffff;
            --accent: #ff4757;
            --green: #2ed573;
            --shadow: 0 10px 25px rgba(0,0,0,0.45);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; touch-action: manipulation; -webkit-tap-highlight-color: transparent; }

        body {
            background: var(--bg); color: var(--text); font-family: "Segoe UI", sans-serif;
            display: flex; min-height: 100vh; justify-content: center; padding: 20px;
            user-select: none; -webkit-user-select: none;
        }

        .game-wrapper { width: 100%; max-width: 480px; }

        .game-container {
            background: var(--card); padding: 25px; border-radius: 20px;
            box-shadow: var(--shadow); border: 1px solid #272727;
        }

        /* Header */
        .top-header { text-align: center; margin-bottom: 15px; }
        h1 { color: var(--accent); font-size: 2.3rem; text-transform: uppercase; letter-spacing: 2px; margin-bottom: 6px; }
        .badge { background: var(--green); color: #000; padding: 4px 10px; border-radius: 10px; font-size: .9rem; }
        .zone { font-style: italic; opacity: .8; }

        /* Status */
        .status-box { margin-top: 10px; }
        .status-row { display: flex; justify-content: space-between; font-size: .9rem; margin-top: 6px; }
        .bar-bg { background: #333; height: 15px; border-radius: 8px; overflow: hidden; margin: 5px 0 10px; }
        .bar-fill { background: var(--green); height: 100%; width: 100%; transition: width .3s, background-color .3s; }

        /* Arena */
        .arena { text-align: center; margin: 20px 0; position: relative; }
        .enemy-title { color: var(--accent); margin-bottom: 10px; }
        .keli-zone { display: flex; flex-direction: column; align-items: center; position: relative; height: 150px; justify-content: center; }
        
        .keli-avatar {
            font-size: 110px; cursor: pointer; transition: .12s;
            filter: drop-shadow(0 0 10px rgba(255, 255, 255, 0.14));
            z-index: 10;
        }
        .keli-avatar:active { transform: scale(0.95); }
        .keli-avatar.hit { transform: scale(0.9) rotate(4deg); color: var(--accent); }
        .keli-avatar.dead { opacity: 0.45; filter: grayscale(100%); pointer-events: none; transform: rotate(180deg); }

        .weapon-anim {
            font-size: 4rem; opacity: 0; position: absolute;
            top: 50%; left: 50%; transform: translate(-50%, -50%) scale(0.5);
            pointer-events: none; z-index: 20;
        }
        /* Animation Klasse f√ºr JS */
        .anim-smash { animation: smash 0.15s ease-out forwards; }
        @keyframes smash {
            0% { opacity: 0; transform: translate(-50%, -50%) scale(0.5) rotate(0deg); }
            50% { opacity: 1; transform: translate(-50%, -50%) scale(1.2) rotate(-45deg); }
            100% { opacity: 0; transform: translate(-50%, -50%) scale(1.0) rotate(-90deg); }
        }

        /* Logs */
        .log-text { margin-top: 10px; opacity: 0.85; min-height: 24px; color: var(--green); font-weight: bold; }

        /* Buttons */
        .btn-main {
            margin-top: 10px; padding: 15px 30px; width: 100%; border: none;
            background: var(--accent); color: white; font-weight: bold; border-radius: 50px;
            font-size: 1.4rem; cursor: pointer; transition: .15s;
        }
        .btn-main:hover { filter: brightness(1.1); }

        /* Tabs */
        .tabs { display: flex; gap: 6px; margin-top: 15px; }
        .tab {
            flex: 1; padding: 10px; border: none; background: #2a2a2a;
            color: #ddd; border-radius: 10px; cursor: pointer; transition: .15s;
        }
        .tab.active { background: var(--accent); color: white; }
        .tab-content { display: none; margin-top: 15px; height: 300px; overflow-y: auto; }
        .tab-content.active { display: block; }

        /* Shop Grid */
        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        .shop-item {
            background: #2a2a2a; padding: 10px; border-radius: 10px; cursor: pointer; text-align: left;
            border: 1px solid transparent;
        }
        .shop-item.owned { border-color: gold; color: #aaa; }
        .shop-item.active { border-color: var(--green); background: #1a332a; }
        .shop-item h4 { font-size: 0.9rem; margin-bottom: 2px; }
        .shop-item small { font-size: 0.75rem; color: var(--accent); }

        /* Casino */
        .casino-box {
            background: #18181d; padding: 15px; border-radius: 14px;
            margin-bottom: 20px; border: 1px solid #2a2a2a; text-align: center;
        }
        .casino-title { text-align: center; margin-bottom: 10px; color: gold; }
        .cards { display: flex; gap: 6px; margin: 8px 0; justify-content: center; min-height: 40px; }
        .card { background: white; color: black; padding: 5px; border-radius: 4px; font-weight: bold; width: 30px; }
        
        .slot-row { display: flex; justify-content: center; gap: 10px; margin: 10px 0; background: #000; padding: 10px; border-radius: 8px; }
        .reel { font-size: 2.5rem; }
        .coin-display { font-size: 3.5rem; margin: 10px 0; }

        /* Casino Buttons */
        .c-btn {
            background: #444; color: white; border: none; padding: 10px 20px;
            border-radius: 12px; font-size: 1rem; cursor: pointer; margin-top: 10px; width: 100%;
        }
        .c-btn.green { background: var(--green); color: #000; }
        .c-btn.red { background: var(--accent); }
        .bet-in {
            width: 100%; padding: 8px; border-radius: 8px; border: none;
            margin-top: 8px; background: #2a2a2a; color: white; text-align: center;
        }

        .hidden { display: none !important; }
    </style>
</head>

<body>
    <main class="game-wrapper">
        <div class="game-container">

            <header class="top-header">
                <h1>Z' D√ñV <span id="lvl-badge" class="badge">LVL 1</span></h1>
                <p id="zone-name" class="zone">üìç HINTERHOF</p>
            </header>

            <section class="status-box">
                <div class="status-row">
                    <label>HP:</label>
                    <span id="hp-txt">100/100</span>
                </div>
                <div class="bar-bg"><div id="hp-bar" class="bar-fill"></div></div>

                <div class="status-row money">
                    <label>Money:</label>
                    <span id="money-txt">0 ‚Ç¨</span>
                </div>
            </section>

            <section class="arena">
                <h2 id="enemy-name" class="enemy-title">VS OGUZ</h2>

                <div class="keli-zone">
                    <div id="face" class="keli-avatar" onpointerdown="hit(event)">üë®‚Äçü¶≤</div>
                    <div id="weapon-anim" class="weapon-anim">üëä</div>
                </div>

                <p id="msg" class="log-text">Mach ihn platt!</p>

                <button id="next-btn" class="btn-main hidden" onclick="nextLevel()">WEITER >></button>
            </section>

            <section class="shop">
                <div class="tabs">
                    <button class="tab active" onclick="tab('waffen')">‚öîÔ∏è Waffen</button>
                    <button class="tab" onclick="tab('crew')">üë• Crew</button>
                    <button class="tab" onclick="tab('casino')">üé∞ Casino</button>
                </div>

                <div id="tab-waffen" class="tab-content active">
                    <div id="weapon-list" class="grid"></div>
                </div>

                <div id="tab-crew" class="tab-content">
                    <div id="staff-list" class="grid"></div>
                </div>

                <div id="tab-casino" class="tab-content">

                    <div class="casino-box">
                        <h3 class="casino-title">üÉè BLACKJACK (3:2)</h3>
                        <p class="sub">Dealer: <span id="d-score">0</span></p>
                        <div id="d-cards" class="cards"></div>
                        <p class="sub">Du: <span id="p-score">0</span></p>
                        <div id="p-cards" class="cards"></div>
                        <input type="number" id="bj-bet" class="bet-in" value="100">
                        
                        <div id="bj-start-div"><button class="c-btn" onclick="startBJ()">START</button></div>
                        <div id="bj-play-div" class="hidden">
                            <button class="c-btn green" onclick="hitBJ()">HIT</button>
                            <button class="c-btn red" onclick="standBJ()">STAND</button>
                        </div>
                    </div>

                    <div class="casino-box">
                        <h3 class="casino-title">üé∞ SLOTS (High Risk)</h3>
                        <div class="slot-row">
                            <div id="reel1" class="reel">üëä</div>
                            <div id="reel2" class="reel">üçí</div>
                            <div id="reel3" class="reel">üíé</div>
                        </div>
                        <button id="slot-btn" class="c-btn" onclick="spinSlots()">100‚Ç¨ DREHEN</button>
                    </div>

                    <div class="casino-box">
                        <h3 class="casino-title">üü° YAZI TURA (x2)</h3>
                        <div id="coin-display" class="coin-display">ü™ô</div>
                        <input type="number" id="coin-bet" class="bet-in" placeholder="Einsatz">
                        <button class="c-btn" onclick="spinCoin()">WERFEN</button>
                    </div>

                </div>
            </section>

        </div>
    </main>

    <script>
        // --- CONFIG & DATA ---
        // Soundeffekte (Name muss auf GitHub stimmen!)
        const sounds = { hit: new Audio('hit.m4a'), buy: new Audio('buy.mp3'), win: new Audio('win.mp3') };
        function snd(t){ try{ let s=sounds[t].cloneNode(); s.volume=0.5; s.play().catch(()=>{}); }catch(e){} }

        const weapons = {
            'fist': {name:'Faust', dmg:[5,10], icon:'üëä', price:0},
            'slipper': {name:'Terlik', dmg:[15,25], icon:'ü©¥', price:50},
            'pan': {name:'Pfanne', dmg:[35,50], icon:'üç≥', price:250},
            'hammer': {name:'Hammer', dmg:[70,100], icon:'üî®', price:600},
            'bat': {name:'Keule', dmg:[150,250], icon:'üèè', price:1500},
            'fart': {name:'Atom-D√∂v', dmg:[500,999], icon:'‚ò£Ô∏è', price:5000}
        };

        const staff = {
            'champ': {name:'Champ', dps:1, price:100, icon:'üß¢'},
            'lion': {name:'Lion', dps:5, price:500, icon:'üï∂Ô∏è'},
            'haji': {name:'Haji Han', dps:25, price:2000, icon:'üòé'}
        };

        // Gegner Gesichter (Normal / Getroffen)
        const faces = { 
            1: {norm:"üë®‚Äçü¶≤", hit:"üòñ"}, 
            2: {norm:"üßîüèª", hit:"üò´"}, 
            3: {norm:"üßë‚Äçü¶±", hit:"ü§ï"} 
        };

        // Spielstand
        let game = { money: 0, level: 1, hp: 100, maxHp: 100, inv: ['fist'], weapon: 'fist', staff: { 'champ':0, 'lion':0, 'haji':0 } };
        let isDead = false;

        // --- INITIALISIERUNG ---
        // Laden
        let s = localStorage.getItem('zDov_Final_V8');
        if(s) try { game = {...game, ...JSON.parse(s)}; } catch(e){}
        
        // Safety: Falls Spielstand kaputt
        if(game.hp <= 0) { isDead = true; game.hp=0; showNextBtn(); }

        // Start
        renderShop();
        updateUI();
        updateZone();

        // Auto DPS Loop
        setInterval(()=>{
            if(isDead) return;
            let dps = (game.staff.champ*1) + (game.staff.lion*5) + (game.staff.haji*25);
            if(dps>0) damage(dps);
        }, 1000);

        // Auto Save Loop
        setInterval(()=>{ localStorage.setItem('zDov_Final_V8', JSON.stringify(game)); }, 3000);


        // --- KAMPF SYSTEM ---
        function hit(e) {
            if(isDead) return;
            snd('hit');
            
            let w = weapons[game.weapon];
            let dmg = Math.floor(Math.random()*(w.dmg[1]-w.dmg[0]+1)+w.dmg[0]);
            
            // Crit Chance
            if(Math.random()<0.15) { dmg*=2; msg("CRIT! "+dmg, "red"); }
            
            game.money += Math.floor(Math.random()*3 + game.level);
            
            // --- ANIMATIONEN ---
            let f = document.getElementById('face');
            let a = document.getElementById('weapon-anim');
            let z = game.level<=10?1:(game.level<=20?2:3); // Zone bestimmen

            // Gesicht kurz √§ndern & wackeln
            f.innerText = faces[z].hit;
            f.classList.remove('hit');
            void f.offsetWidth; // Reset Trick
            f.classList.add('hit');
            setTimeout(()=>{ if(!isDead) f.innerText = faces[z].norm; }, 150);

            // Waffe anzeigen
            a.innerText = w.icon;
            a.classList.remove('anim-smash');
            void a.offsetWidth;
            a.classList.add('anim-smash');

            damage(dmg);
        }

        function damage(amount) {
            game.hp -= amount;
            if(game.hp <= 0) {
                game.hp = 0;
                kill();
            }
            updateUI();
        }

        function kill() {
            if(isDead) return;
            isDead = true;
            snd('win');
            document.getElementById('face').innerText = "üòµ";
            document.getElementById('face').classList.add('dead');
            showNextBtn();
            
            let bonus = 50 * game.level;
            game.money += bonus;
            msg("SIEG! +"+bonus+"‚Ç¨", "#2ed573");
            updateUI();
        }

        function showNextBtn() {
            document.getElementById('next-btn').classList.remove('hidden');
        }

        function nextLevel() {
            game.level++;
            game.maxHp = Math.floor(game.maxHp * 1.4);
            game.hp = game.maxHp;
            isDead = false;
            
            document.getElementById('face').classList.remove('dead');
            document.getElementById('next-btn').classList.add('hidden');
            msg("Level "+game.level, "cyan");
            
            updateZone();
            updateUI();
        }

        function updateZone() {
            // Hintergrund und Name je nach Level
            let b = document.body;
            let n = document.getElementById('enemy-name');
            let zn = document.getElementById('zone-name');
            let f = document.getElementById('face');

            b.className = ''; // Reset Classes
            if(game.level <= 10) {
                // HINTERHOF
                // Hintergrund ist standard CSS var(--bg), aber wir k√∂nnen spezielle Klassen nutzen wenn wir wollen
                n.innerText="VS OGUZ"; zn.innerText="üìç HINTERHOF";
                if(!isDead) f.innerText = faces[1].norm;
            } else if(game.level <= 20) {
                // SHISHA
                n.innerText="VS YNSANON"; zn.innerText="üìç SHISHA BAR";
                if(!isDead) f.innerText = faces[2].norm;
            } else {
                // BOX CLUB
                n.innerText="VS MIKAUTADZE"; zn.innerText="üìç BOX CLUB";
                if(!isDead) f.innerText = faces[3].norm;
            }
        }

        // --- UI FUNKTIONEN ---
        function updateUI() {
            document.getElementById('money-txt').innerText = game.money + " ‚Ç¨";
            document.getElementById('hp-txt').innerText = Math.floor(game.hp) + "/" + Math.floor(game.maxHp);
            document.getElementById('lvl-badge').innerText = "LVL " + game.level;
            let p = (game.hp/game.maxHp)*100; if(p<0)p=0;
            document.getElementById('hp-bar').style.width = p+"%";
        }

        function msg(txt, col) {
            let m = document.getElementById('msg');
            m.innerText = txt;
            m.style.color = col || "var(--green)";
        }

        function tab(name) {
            document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.getElementById('tab-'+name).classList.add('active');
            event.target.classList.add('active');
        }

        // --- SHOP RENDER ---
        function renderShop() {
            // Waffen
            let wHTML = "";
            for(let key in weapons) {
                let w = weapons[key];
                let owned = game.inv.includes(key);
                let active = game.weapon === key;
                let css = "shop-item" + (owned ? " owned" : "") + (active ? " active" : "");
                let sub = owned ? "Besitz" : w.price + " ‚Ç¨";
                
                wHTML += `<div class="${css}" onclick="buyW('${key}')">
                    <div style="font-size:1.5rem">${w.icon}</div>
                    <div><h4>${w.name}</h4><small>${sub}</small></div>
                </div>`;
            }
            document.getElementById('weapon-list').innerHTML = wHTML;

            // Crew
            let sHTML = "";
            for(let key in staff) {
                let s = staff[key];
                let cost = Math.floor(s.price * Math.pow(1.2, game.staff[key]));
                sHTML += `<div class="shop-item" onclick="buyS('${key}')">
                    <div style="font-size:1.5rem">${s.icon}</div>
                    <div style="flex:1"><h4>${s.name}</h4><small>${cost} ‚Ç¨</small></div>
                    <div style="background:var(--accent); padding:2px 6px; border-radius:50%; font-size:0.8rem; color:white">${game.staff[key]}</div>
                </div>`;
            }
            document.getElementById('staff-list').innerHTML = sHTML;
        }

        function buyW(k) {
            let w = weapons[k];
            if(game.inv.includes(k)) { game.weapon = k; }
            else if(game.money >= w.price) { game.money-=w.price; game.inv.push(k); game.weapon=k; snd('buy'); }
            else { msg("Zu teuer!", "var(--accent)"); }
            renderShop(); updateUI();
        }

        function buyS(k) {
            let s = staff[k];
            let cost = Math.floor(s.price * Math.pow(1.2, game.staff[k]));
            if(game.money >= cost) { game.money-=cost; game.staff[k]++; snd('buy'); }
            else { msg("Zu teuer!", "var(--accent)"); }
            renderShop(); updateUI();
        }

        // --- CASINO LOGIC ---
        
        // Yazi Tura
        function spinCoin() {
            let bet = parseInt(document.getElementById('coin-bet').value);
            if(bet > game.money || isNaN(bet) || bet <= 0) return msg("Einsatz ung√ºltig!", "var(--accent)");
            game.money -= bet; updateUI();
            
            let c = document.getElementById('coin-display');
            let i = 0;
            let interval = setInterval(() => {
                c.innerText = i%2==0 ? "üü°" : "ü¶Ö";
                i++;
                if(i > 10) {
                    clearInterval(interval);
                    let win = Math.random() < 0.5;
                    c.innerText = win ? "üü°" : "ü¶Ö";
                    if(win) { game.money += bet*2; msg("GEWONNEN!", "var(--green)"); snd('buy'); }
                    else msg("VERLOREN!", "var(--accent)");
                    updateUI();
                }
            }, 100);
        }

        // Slots
        function spinSlots() {
            if(game.money < 100) return msg("Brauchst 100‚Ç¨", "var(--accent)");
            game.money -= 100; updateUI();
            
            let b = document.getElementById('slot-btn'); b.disabled = true;
            let sym = ["üëä","ü©¥","üçí","üíé"];
            let r1 = document.getElementById('reel1');
            let r2 = document.getElementById('reel2');
            let r3 = document.getElementById('reel3');
            
            // Animation Loop
            let count = 0;
            let anim = setInterval(() => {
                r1.innerText = sym[Math.floor(Math.random()*4)];
                r2.innerText = sym[Math.floor(Math.random()*4)];
                r3.innerText = sym[Math.floor(Math.random()*4)];
                count++;
                if(count > 10) clearInterval(anim);
            }, 100);

            // Ergebnis nach 1.2s
            setTimeout(() => {
                let res1 = sym[Math.floor(Math.random()*4)];
                let res2 = sym[Math.floor(Math.random()*4)];
                let res3 = sym[Math.floor(Math.random()*4)];
                r1.innerText = res1; r2.innerText = res2; r3.innerText = res3;
                b.disabled = false;

                if(res1 == res3 && res2 == res3) {
                    let w = res1=='üíé' ? 1000 : 300; 
                    game.money += w; msg("JACKPOT! +"+w, "gold"); snd('win');
                } else msg("Niete!", "var(--accent)");
                updateUI();
            }, 1200);
        }

        // Blackjack
        let deck=[], pHand=[], dHand=[], bjBet=0;
        function startBJ() {
            let bet = parseInt(document.getElementById('bj-bet').value);
            if(bet > game.money || bet <= 0 || isNaN(bet)) return msg("Einsatz?", "var(--accent)");
            
            game.money -= bet; bjBet=bet; updateUI();
            document.getElementById('bj-start-div').classList.add('hidden');
            document.getElementById('bj-play-div').classList.remove('hidden');
            
            // Simples Deck (unendlich)
            deck = [2,3,4,5,6,7,8,9,10,10,10,10,11, 2,3,4,5,6,7,8,9,10,10,10,10,11, 10, 10, 10]; 
            pHand = [draw(), draw()]; dHand = [draw()];
            renderBJ();
            if(score(pHand) === 21) endBJ(true);
        }
        function draw() { return deck[Math.floor(Math.random()*deck.length)]; }
        function score(h) {
            let s = h.reduce((a,b)=>a+b,0);
            let aces = h.filter(x=>x==11).length;
            while(s>21 && aces>0) { s-=10; aces--; }
            return s;
        }
        function renderBJ() {
            document.getElementById('p-score').innerText = score(pHand);
            document.getElementById('d-score').innerText = score(dHand);
            document.getElementById('p-cards').innerHTML = pHand.map(c=>`<div class="card">${c==11?'A':c}</div>`).join('');
            document.getElementById('d-cards').innerHTML = dHand.map(c=>`<div class="card">${c==11?'A':c}</div>`).join('');
        }
        function hitBJ() {
            pHand.push(draw()); renderBJ();
            if(score(pHand)>21) endBJ(false);
        }
        function standBJ() {
            // Dealer Logik: Zieht bis 17
            let loop = setInterval(() => {
                if(score(dHand) < 17) {
                    dHand.push(draw()); renderBJ();
                } else {
                    clearInterval(loop);
                    let p=score(pHand), d=score(dHand);
                    if(d>21 || p>d) endBJ(true);
                    else if(p==d) endBJ('tie');
                    else endBJ(false);
                }
            }, 800);
        }
        function endBJ(res) {
            if(res===true) { game.money += Math.floor(bjBet*2); msg("BJ: SIEG!", "var(--green)"); snd('buy'); }
            else if(res==='tie') { game.money += bjBet; msg("BJ: Unentschieden", "gold"); }
            else msg("BJ: Verloren", "var(--accent)");
            
            document.getElementById('bj-start-div').classList.remove('hidden');
            document.getElementById('bj-play-div').classList.add('hidden');
            updateUI();
        }

    </script>
</body>
</html>
