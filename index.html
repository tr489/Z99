<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Z' D√ñV - CASINO ROYAL</title>
    <style>
        /* --- GRUNDLAGEN --- */
        * {
            touch-action: manipulation; 
            -webkit-tap-highlight-color: transparent;
            box-sizing: border-box;
        }

        body {
            background-color: #0a0a12;
            color: white;
            font-family: "Courier New", Courier, monospace; 
            text-align: center;
            margin: 0;
            padding: 10px;
            overflow: hidden;
            user-select: none;
            -webkit-user-select: none;
            transition: background-color 1s ease;
        }

        /* --- √úBERSCHRIFTEN --- */
        h1 { 
            color: #ff00ff; 
            margin: 0; 
            font-size: 2.2rem; 
            text-transform: uppercase; 
            letter-spacing: 2px;
            text-shadow: 0 0 10px rgba(255, 0, 255, 0.7), 0 0 20px rgba(0, 255, 255, 0.5);
        }
        
        .level-badge {
            background: linear-gradient(45deg, #ff00ff, #00ffff);
            color: black;
            font-weight: bold;
            padding: 2px 8px;
            border-radius: 2px;
            font-size: 0.8rem;
            vertical-align: middle;
            box-shadow: 0 0 10px rgba(0, 255, 255, 0.5);
        }

        #save-notify {
            position: absolute;
            top: 10px; right: 10px;
            font-size: 0.8rem;
            color: #00ffff;
            text-shadow: 0 0 5px #00ffff;
            opacity: 0;
            transition: opacity 0.5s;
        }

        /* --- STATS BAR --- */
        .stats-bar {
            background: rgba(10, 10, 20, 0.8);
            padding: 8px;
            margin-top: 10px;
            border: 1px solid #00ffff;
            box-shadow: inset 0 0 10px rgba(0, 255, 255, 0.2);
            display: flex;
            justify-content: space-around;
            font-size: 0.9rem;
            backdrop-filter: blur(5px);
        }
        
        .money { color: #f1c40f; font-weight: bold; font-size: 1.1rem; text-shadow: 0 0 5px #f1c40f; }

        /* --- ARENA --- */
        .arena {
            height: 220px; /* Etwas kleiner damit Casino Platz hat */
            display: flex;
            justify-content: center;
            align-items: center;
            position: relative;
            margin-top: 10px;
        }

        #face {
            font-size: 120px;
            cursor: pointer;
            transition: transform 0.05s;
            z-index: 10;
            filter: drop-shadow(0 0 25px rgba(0, 255, 255, 0.3));
            position: relative;
            touch-action: manipulation; 
        }

        #face:active { transform: scale(0.9); }

        #weapon-anim {
            position: absolute;
            font-size: 80px;
            opacity: 0;
            pointer-events: none;
            z-index: 11;
            transition: all 0.1s;
        }

        .smash-anim {
            opacity: 1 !important;
            transform: scale(1.2) rotate(-45deg) !important;
            left: 55% !important; 
        }

        /* --- PARTIKEL --- */
        .particle {
            position: absolute;
            pointer-events: none;
            background: #00ffff;
            box-shadow: 0 0 5px #00ffff;
            width: 6px;
            height: 6px;
            border-radius: 50%;
            z-index: 99;
            animation: fly 0.6s linear forwards;
        }
        @keyframes fly {
            0% { transform: translate(0,0) scale(1); opacity: 1; }
            100% { transform: translate(var(--tx), var(--ty)) scale(0); opacity: 0; }
        }

        /* Animationen */
        .hit { color: #ff00ff; transform: rotate(15deg) scale(0.95); filter: drop-shadow(0 0 10px #ff00ff); }
        .dead { filter: grayscale(100%) brightness(0.5); opacity: 0.7; transform: rotate(180deg); pointer-events: none; }

        /* --- BALKEN --- */
        .bar-container {
            width: 90%;
            height: 20px;
            border: 2px solid #ff00ff;
            box-shadow: 0 0 10px rgba(255, 0, 255, 0.3);
            margin: 0 auto;
            position: relative;
            background: rgba(0,0,0,0.7);
            overflow: hidden;
        }

        .bar-fill {
            height: 100%;
            background: linear-gradient(90deg, #ff00ff, #00ffff);
            width: 100%;
            transition: width 0.1s;
        }

        /* --- SHOP AREA --- */
        .shop-area {
            margin-top: 10px;
            padding-top: 10px;
            background: rgba(10, 10, 15, 0.95);
            border-top: 2px solid #00ffff;
            box-shadow: 0 -5px 20px rgba(0, 255, 255, 0.2);
            padding-bottom: 60px;
            height: 340px;
            overflow-y: auto;
            background-image: linear-gradient(transparent 50%, rgba(0, 255, 255, 0.05) 50%);
            background-size: 10px 4px;
        }

        .tab-buttons {
            display: flex;
            justify-content: center;
            gap: 5px;
            margin-bottom: 15px;
            padding: 0 5px;
        }
        
        .tab-btn {
            background: rgba(0,0,0,0.5);
            border: 1px solid #555;
            color: #888;
            padding: 8px 10px;
            cursor: pointer;
            font-family: sans-serif;
            text-transform: uppercase;
            font-size: 0.8rem;
            letter-spacing: 1px;
            transition: 0.3s;
            position: relative;
            overflow: hidden;
            flex: 1; /* Buttons gleich breit */
        }
        
        .tab-btn.active {
            background: rgba(0, 255, 255, 0.1);
            color: #00ffff;
            border-color: #00ffff;
            font-weight: bold;
            box-shadow: 0 0 15px rgba(0, 255, 255, 0.3) inset;
        }

        .shop-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            max-width: 420px;
            margin: 0 auto;
            padding: 0 10px;
        }

        .shop-btn {
            background: linear-gradient(135deg, rgba(20, 20, 30, 0.9), rgba(10, 10, 20, 0.9));
            color: #aaa;
            border: 1px solid #333;
            padding: 10px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: flex-start;
            gap: 10px;
            text-align: left;
            position: relative;
        }

        .shop-btn.owned { border-color: #f1c40f; color: #ddd; box-shadow: inset 0 0 10px rgba(241, 196, 15, 0.2); }
        .shop-btn.active { border-color: #00ffff; box-shadow: 0 0 10px #00ffff; color: white;}
        
        .shop-btn .icon { font-size: 1.8rem; }
        .shop-btn h4 { margin: 0; font-size: 0.8rem; text-transform: uppercase; }
        .shop-btn small { font-size: 0.7rem; color: #00ffff; }
        
        .count-badge {
            position: absolute; top: 5px; right: 5px; background: #ff00ff; color: white;
            width: 20px; height: 20px; font-size: 0.7rem; display: flex; align-items: center; justify-content: center;
            font-weight: bold; border-radius: 2px;
        }

        /* --- CASINO STYLES --- */
        .casino-box {
            background: rgba(0,0,0,0.5);
            border: 1px solid #f1c40f;
            padding: 10px;
            margin-bottom: 15px;
            width: 90%;
            max-width: 400px;
            margin-left: auto;
            margin-right: auto;
        }
        
        .casino-title { color: #f1c40f; margin: 0 0 10px 0; text-transform: uppercase; font-size: 1rem; border-bottom: 1px solid #333; padding-bottom: 5px; }
        
        .bet-input {
            background: #111; border: 1px solid #555; color: #00ffff; 
            padding: 8px; width: 60%; text-align: center; font-family: "Courier New"; font-size: 1rem;
            margin-bottom: 10px;
        }
        
        .casino-btn {
            background: #333; border: 1px solid #f1c40f; color: #f1c40f;
            padding: 10px 15px; cursor: pointer; font-weight: bold; text-transform: uppercase;
            transition: 0.2s; margin: 2px;
        }
        .casino-btn:active { background: #f1c40f; color: black; }
        
        .roulette-btn { width: 30%; border: none; color: white; }
        .btn-red { background: #e74c3c; }
        .btn-black { background: #333; border: 1px solid #555; }
        .btn-green { background: #2ed573; }

        .slot-display {
            font-size: 2.5rem; letter-spacing: 5px; background: black; border: 2px solid #f1c40f;
            padding: 10px; margin-bottom: 10px; text-shadow: 0 0 10px gold;
        }

        #msg { min-height: 20px; color: #00ffff; margin: 5px 0; font-weight: bold; font-size: 0.9rem; text-shadow: 0 0 5px rgba(0,255,255,0.5);}

        #reset-btn {
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
            padding: 15px 40px; font-size: 1.2rem;
            background: linear-gradient(90deg, #00b894, #00cec9); border: 2px solid #00ff00;
            color: black; font-weight: bold; cursor: pointer;
            box-shadow: 0 0 30px rgba(0, 255, 0, 0.7); z-index: 20;
        }
        .hidden { display: none; }

    </style>
</head>
<body>

    <div id="save-notify">üíæ SAVED</div>

    <h1>Z' D√ñV <span class="level-badge" id="lvl-badge">LVL 1</span></h1>
    
    <div class="stats-bar">
        <span>Oguz HP: <b id="hp-val">100</b></span>
        <span class="money"><span id="money-val">0</span> ‚Ç¨</span>
    </div>

    <div class="bar-container">
        <div id="health" class="bar-fill"></div>
    </div>
    
    <p id="msg">Mach ihn fertig!</p>

    <div class="arena">
        <div id="weapon-anim">üëä</div>
        <div id="face" onclick="manualAttack(event)">üë®‚Äçü¶≤</div>
        <button id="reset-btn" class="hidden" onclick="nextLevel()">N√ÑCHSTES LEVEL >>></button>
    </div>

    <div class="shop-area">
        <div class="tab-buttons">
            <button class="tab-btn active" onclick="showTab('weapons')">‚öîÔ∏è Waffen</button>
            <button class="tab-btn" onclick="showTab('staff')">üë• Crew</button>
            <button class="tab-btn" onclick="showTab('casino')" style="color: gold; border-color: gold;">üé∞ Casino</button>
        </div>

        <div id="tab-weapons" class="shop-grid">
            <button id="w-fist" class="shop-btn active" onclick="equip('fist')">
                <span class="icon">üëä</span>
                <div><h4>Keremin yumrugu</h4><small>Gratis</small></div>
            </button>
            <button id="w-slipper" class="shop-btn" onclick="buyWeapon('slipper', 50)">
                <span class="icon">ü©¥</span>
                <div><h4>Terlik v2.0</h4><small>50 ‚Ç¨</small></div>
            </button>
            <button id="w-pan" class="shop-btn" onclick="buyWeapon('pan', 250)">
                <span class="icon">üç≥</span>
                <div><h4>Pfanne</h4><small>250 ‚Ç¨</small></div>
            </button>
            <button id="w-hammer" class="shop-btn" onclick="buyWeapon('hammer', 600)">
                <span class="icon">üî®</span>
                <div><h4>Hammer</h4><small>600 ‚Ç¨</small></div>
            </button>
             <button id="w-bat" class="shop-btn" onclick="buyWeapon('bat', 1500)">
                <span class="icon">üèè</span>
                <div><h4>Laser-Keule</h4><small>1500 ‚Ç¨</small></div>
            </button>
            <button id="w-fart" class="shop-btn" onclick="buyWeapon('fart', 6868)">
                <span class="icon">‚ò£Ô∏è</span>
                <div><h4>Sakirin osurugu</h4><small>6868 ‚Ç¨</small></div>
            </button>
        </div>

        <div id="tab-staff" class="shop-grid hidden">
            <button class="shop-btn" onclick="hireStaff('Champ', 100)">
                <span class="icon">üß¢</span>
                <div><h4>Champ</h4><small>100 ‚Ç¨ (1/s)</small></div>
                <div id="cnt-Champ" class="count-badge hidden">0</div>
            </button>
            <button class="shop-btn" onclick="hireStaff('Lion', 500)">
                <span class="icon">üï∂Ô∏è</span>
                <div><h4>Lion</h4><small>500 ‚Ç¨ (5/s)</small></div>
                <div id="cnt-Lion" class="count-badge hidden">0</div>
            </button>
             <button class="shop-btn" onclick="hireStaff('Haji Han', 2000)">
                <span class="icon">üòé</span>
                <div><h4>Haji Han </h4><small>2k ‚Ç¨ (25/s)</small></div>
                <div id="cnt-Haji Han" class="count-badge hidden">0</div>
            </button>
        </div>

        <div id="tab-casino" class="hidden">
            
            <div class="casino-box">
                <h4 class="casino-title">üü° YAZI TURA (x2)</h4>
                <input type="number" id="bet-coin" class="bet-input" placeholder="Einsatz">
                <br>
                <button class="casino-btn" onclick="playCoinFlip()">WERFEN</button>
            </div>

            <div class="casino-box">
                <h4 class="casino-title">üé∞ OGUZ SLOTS</h4>
                <div id="slot-display" class="slot-display">üëä üëä üëä</div>
                <small>Kosten: 100 ‚Ç¨ pro Dreh</small><br>
                <button class="casino-btn" onclick="playSlots()">DREHEN</button>
            </div>

            <div class="casino-box">
                <h4 class="casino-title">üé≤ HINTERHOF ROULETTE</h4>
                <input type="number" id="bet-roulette" class="bet-input" placeholder="Einsatz">
                <br>
                <button class="casino-btn roulette-btn btn-red" onclick="playRoulette('red')">ROT (x2)</button>
                <button class="casino-btn roulette-btn btn-black" onclick="playRoulette('black')">SCHWARZ (x2)</button>
                <button class="casino-btn roulette-btn btn-green" onclick="playRoulette('green')">GR√úN (x14)</button>
            </div>

        </div>
    </div>

    <script>
        // --- SOUNDS ---
        const sounds = {
            hit: new Audio('hit.m4a'),
            buy: new Audio('buy.mp3'),
            win: new Audio('win.mp3')
        };
        sounds.hit.volume = 0.6;
        sounds.buy.volume = 0.8;
        sounds.win.volume = 1.0;

        function playSound(type) {
            try {
                let s = sounds[type].cloneNode();
                s.volume = sounds[type].volume;
                s.play().catch(e => {});
            } catch (e) { }
        }
        
        document.addEventListener('dblclick', function(event) { event.preventDefault(); }, { passive: false });

        // --- GAME STATE ---
        let state = {
            level: 1,
            maxHp: 100,
            hp: 100,
            money: 0,
            inventory: ['fist'],
            currentWeapon: 'fist',
            staff: { 'Champ': 0, 'Lion': 0, 'Haji Han': 0 }
        };

        let isDead = false;

        const weapons = {
            'fist':    { dmg: [5, 9],    icon: 'üëä', name: 'Keremin yumrugu' },
            'slipper': { dmg: [15, 25],  icon: 'ü©¥', name: 'Terlik v2.0' },
            'pan':     { dmg: [35, 55],  icon: 'üç≥', name: 'Cyber-Pfanne' },
            'hammer':  { dmg: [70, 100], icon: 'üî®', name: 'Hammer X-9000' },
            'bat':     { dmg: [150, 250], icon: 'üèè', name: 'Laser-Keule' },
            'fart':    { dmg: [500, 999], icon: '‚ò£Ô∏è', name: 'Sakirin osurugu' }
        };

        const staffData = {
            'Champ': { dps: 1, name: "Champ" },
            'Lion':  { dps: 5, name: "Lion" },
            'Haji Han': { dps: 25, name: "Haji Han" }
        };

        // Elemente
        const face = document.getElementById('face');
        const hpBar = document.getElementById('health');
        const hpVal = document.getElementById('hp-val');
        const moneyEl = document.getElementById('money-val');
        const msg = document.getElementById('msg');
        const weaponAnim = document.getElementById('weapon-anim');
        const resetBtn = document.getElementById('reset-btn');
        const lvlBadge = document.getElementById('lvl-badge');
        const saveNotify = document.getElementById('save-notify');

        // --- INIT ---
        loadGame(); 
        updateUI();
        updateShopUI();
        setInterval(autoAttack, 1000);
        setInterval(saveGame, 5000);

        // --- CASINO LOGIC ---
        function playCoinFlip() {
            let bet = parseInt(document.getElementById('bet-coin').value);
            if (isNaN(bet) || bet <= 0) { msg.innerText = "Ung√ºltiger Einsatz!"; return; }
            if (bet > state.money) { msg.innerText = "Nicht genug Geld!"; return; }

            state.money -= bet;
            
            // 50% Chance
            if (Math.random() < 0.5) {
                let win = bet * 2;
                state.money += win;
                msg.innerText = "GEWONNEN! +" + win + " ‚Ç¨";
                msg.style.color = "#2ed573";
                playSound('buy');
            } else {
                msg.innerText = "VERLOREN! -" + bet + " ‚Ç¨";
                msg.style.color = "red";
            }
            updateUI();
        }

        function playSlots() {
            let cost = 100;
            if (state.money < cost) { msg.innerText = "Kostet 100 ‚Ç¨!"; return; }
            
            state.money -= cost;
            let symbols = ["üëä", "ü©¥", "üë®‚Äçü¶≤", "üçí", "üíé"];
            
            let s1 = symbols[Math.floor(Math.random() * symbols.length)];
            let s2 = symbols[Math.floor(Math.random() * symbols.length)];
            let s3 = symbols[Math.floor(Math.random() * symbols.length)];
            
            document.getElementById('slot-display').innerText = s1 + " " + s2 + " " + s3;

            if (s1 === s3 && s2 === s3) {
                let win = cost * 10; // Jackpot
                state.money += win;
                msg.innerText = "JACKPOT!!! +" + win;
                msg.style.color = "gold";
                playSound('win');
            } else if (s1 === s2 || s2 === s3 || s1 === s3) {
                let win = cost * 2; // Kleiner Gewinn
                state.money += win;
                msg.innerText = "Kleiner Gewinn! +" + win;
                msg.style.color = "#2ed573";
                playSound('buy');
            } else {
                msg.innerText = "Niete!";
                msg.style.color = "red";
            }
            updateUI();
        }

        function playRoulette(color) {
            let bet = parseInt(document.getElementById('bet-roulette').value);
            if (isNaN(bet) || bet <= 0) { msg.innerText = "Einsatz?"; return; }
            if (bet > state.money) { msg.innerText = "Zu arm!"; return; }

            state.money -= bet;
            
            // 0-36 (0=Gr√ºn, 1-18=Rot, 19-36=Schwarz)
            let roll = Math.floor(Math.random() * 37);
            let resultColor = "";
            
            if (roll === 0) resultColor = "green";
            else if (roll <= 18) resultColor = "red";
            else resultColor = "black";

            if (color === resultColor) {
                let multi = (color === "green") ? 14 : 2;
                let win = bet * multi;
                state.money += win;
                msg.innerText = resultColor.toUpperCase() + "! Sieg! +" + win;
                msg.style.color = "#2ed573";
                playSound('buy');
            } else {
                msg.innerText = "Es war " + resultColor + ". Verloren.";
                msg.style.color = "red";
            }
            updateUI();
        }

        // --- ATTACK SYSTEM ---
        function manualAttack(e) {
            if (isDead) return;
            attackLogic(true, e.clientX, e.clientY);
        }

        function autoAttack() {
            if (isDead) return;
            let totalDps = (state.staff['Champ'] * staffData['Champ'].dps) + 
                           (state.staff['Lion'] * staffData['Lion'].dps) + 
                           (state.staff['Haji Han'] * staffData['Haji Han'].dps);
            if (totalDps > 0) {
                const rect = face.getBoundingClientRect();
                const rx = rect.left + rect.width/2 + (Math.random()-0.5)*50;
                const ry = rect.top + rect.height/2 + (Math.random()-0.5)*50;
                attackLogic(false, rx, ry, totalDps);
            }
        }

        function attackLogic(isManual, x, y, autoDmg = 0) {
            let dmg = 0;
            let currentW = weapons[state.currentWeapon];

            if (isManual) {
                playSound('hit');
                dmg = Math.floor(Math.random() * (currentW.dmg[1] - currentW.dmg[0] + 1)) + currentW.dmg[0];
                if (Math.random() < 0.15) {
                    dmg = Math.floor(dmg * 2);
                    spawnParticles(x, y, 10, '#ff00ff');
                    msg.innerText = "üí• HELAL! " + dmg;
                    msg.style.color = "#ff00ff";
                    if (navigator.vibrate) navigator.vibrate(50);
                } else {
                    spawnParticles(x, y, 4, '#00ffff');
                    msg.innerText = "-" + dmg;
                    msg.style.color = "#00ffff";
                }
                animateWeapon(currentW.icon);
                state.money += Math.floor(Math.random() * 3) + state.level;
            } else {
                dmg = autoDmg;
                spawnParticles(x, y, 1, '#00ff00');
            }

            state.hp -= dmg;
            if (state.hp < 0) state.hp = 0;
            updateUI();
            updateFaceState();
            if (state.hp <= 0) kill();
        }

        function animateWeapon(icon) {
            weaponAnim.innerText = icon;
            weaponAnim.style.left = "60%"; weaponAnim.style.top = "20%";
            setTimeout(() => { weaponAnim.classList.add("smash-anim"); }, 10);
            face.classList.add("hit");
            setTimeout(() => {
                face.classList.remove("hit");
                weaponAnim.classList.remove("smash-anim");
                weaponAnim.style.opacity = "0";
            }, 150);
        }

        function updateFaceState() {
            let p = (state.hp / state.maxHp) * 100;
            if (state.hp > 0) {
                if (p < 30) face.innerText = "ü§¢";
                else if (p < 60) face.innerText = "ü§ï";
                else face.innerText = "üò†";
            }
        }

        function kill() {
            isDead = true;
            playSound('win');
            face.innerText = "üòµ";
            face.classList.add("dead");
            let bonus = 50 * state.level;
            state.money += bonus;
            msg.innerText = "SYSTEM CRASH! + " + bonus + " ‚Ç¨";
            msg.style.color = "#00ff00";
            resetBtn.classList.remove("hidden");
            if (navigator.vibrate) navigator.vibrate([100,50,100]);
            updateUI();
            saveGame(); 
        }

        function nextLevel() {
            state.level++;
            state.maxHp = Math.floor(state.maxHp * 1.4);
            state.hp = state.maxHp;
            isDead = false;
            face.innerText = "üë®‚Äçü¶≤";
            face.classList.remove("dead");
            resetBtn.classList.add("hidden");
            msg.innerText = "Oguz Rebooted!";
            msg.style.color = "#00ffff";
            updateUI();
            saveGame();
        }

        // --- SHOP & UI ---
        function buyWeapon(key, price) {
            if (state.inventory.includes(key)) { equip(key); return; }
            if (state.money >= price) {
                state.money -= price;
                state.inventory.push(key);
                equip(key);
                msg.innerText = "Erworben: " + weapons[key].name;
                playSound('buy');
            } else {
                msg.innerText = "Zu wenig Credits!"; msg.style.color = "#ff00ff";
            }
            updateUI(); updateShopUI();
        }

        function hireStaff(type, price) {
            let count = state.staff[type];
            let realPrice = Math.floor(price * Math.pow(1.2, count));
            if (state.money >= realPrice) {
                state.money -= realPrice;
                state.staff[type]++;
                msg.innerText = "Aktiviert: " + staffData[type].name;
                playSound('buy');
                updateUI(); updateShopUI(); 
            } else {
                msg.innerText = "Zu wenig Credits!"; msg.style.color = "#ff00ff";
            }
        }

        function equip(key) {
            state.currentWeapon = key;
            msg.innerText = "Geladen: " + weapons[key].name;
            updateShopUI();
        }

        function showTab(tabName) {
            document.getElementById('tab-weapons').classList.add('hidden');
            document.getElementById('tab-staff').classList.add('hidden');
            document.getElementById('tab-casino').classList.add('hidden'); // Casino ausblenden
            
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            
            if (tabName === 'weapons') {
                document.getElementById('tab-weapons').classList.remove('hidden');
                document.querySelector('button[onclick="showTab(\'weapons\')"]').classList.add('active');
            } else if (tabName === 'staff') {
                document.getElementById('tab-staff').classList.remove('hidden');
                document.querySelector('button[onclick="showTab(\'staff\')"]').classList.add('active');
            } else {
                document.getElementById('tab-casino').classList.remove('hidden'); // Casino zeigen
                document.querySelector('button[onclick="showTab(\'casino\')"]').classList.add('active');
            }
        }

        function updateUI() {
            moneyEl.innerText = state.money;
            let hpPercent = (state.hp / state.maxHp) * 100;
            hpBar.style.width = hpPercent + "%";
            hpVal.innerText = state.hp + " / " + state.maxHp;
            lvlBadge.innerText = "LVL " + state.level;
            
            let base = 10;
            let r = Math.max(base - state.level, 0);
            let b = Math.min(base + (state.level*2), 50);
            document.body.style.backgroundColor = `rgb(${r}, ${r}, ${b})`;
        }

        function updateShopUI() {
            document.querySelectorAll('#tab-weapons .shop-btn').forEach(btn => {
                btn.classList.remove('active'); btn.classList.remove('owned');
            });
            state.inventory.forEach(key => {
                let btn = document.getElementById('w-' + key);
                if(btn) { btn.classList.add('owned'); btn.querySelector('small').innerText = "BEREIT"; }
            });
            let activeBtn = document.getElementById('w-' + state.currentWeapon);
            if(activeBtn) activeBtn.classList.add('active');

            for (let type in state.staff) {
                let count = state.staff[type];
                let badge = document.getElementById('cnt-' + type);
                if(badge && count > 0) { badge.innerText = count; badge.classList.remove('hidden'); }
            }
        }

        function spawnParticles(x, y, count, color) {
            for (let i = 0; i < count; i++) {
                let p = document.createElement('div');
                p.classList.add('particle');
                p.style.backgroundColor = color;
                p.style.boxShadow = "0 0 5px " + color;
                p.style.left = x + 'px'; p.style.top = y + 'px';
                let tx = (Math.random() - 0.5) * 150;
                let ty = (Math.random() - 0.5) * 150;
                p.style.setProperty('--tx', tx + 'px');
                p.style.setProperty('--ty', ty + 'px');
                document.body.appendChild(p);
                setTimeout(() => p.remove(), 600);
            }
        }

        function saveGame() {
            localStorage.setItem('zDovSave_Oguz', JSON.stringify(state));
            saveNotify.style.opacity = 1;
            setTimeout(() => { saveNotify.style.opacity = 0; }, 1000);
        }

        function loadGame() {
            let saved = localStorage.getItem('zDovSave_Oguz');
            if (saved) {
                try {
                    let parsed = JSON.parse(saved);
                    state = { ...state, ...parsed };
                    if(state.hp <= 0) state.hp = 1; 
                } catch(e) { }
            }
        }
    </script>
</body>
</html>
