<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Z' D√ñV - CASINO ULTIMATE</title>
    <style>
        /* --- GRUNDLAGEN --- */
        * { touch-action: manipulation; -webkit-tap-highlight-color: transparent; box-sizing: border-box; }
        body {
            background-color: #0a0a12; color: white;
            font-family: "Courier New", Courier, monospace; 
            text-align: center; margin: 0; padding: 10px;
            overflow: hidden; user-select: none; -webkit-user-select: none;
            transition: background-color 1s ease;
        }
        h1 { 
            color: #ff00ff; margin: 0; font-size: 2.0rem; text-transform: uppercase; 
            text-shadow: 0 0 10px rgba(255, 0, 255, 0.7);
        }
        .level-badge {
            background: linear-gradient(45deg, #ff00ff, #00ffff); color: black; 
            font-weight: bold; padding: 2px 8px; border-radius: 2px; font-size: 0.8rem; vertical-align: middle;
        }
        #save-notify {
            position: absolute; top: 10px; right: 10px; font-size: 0.8rem;
            color: #00ffff; text-shadow: 0 0 5px #00ffff; opacity: 0; transition: opacity 0.5s;
        }

        /* --- STATS --- */
        .stats-bar {
            background: rgba(10, 10, 20, 0.8); padding: 5px; margin-top: 5px;
            border: 1px solid #00ffff; display: flex; justify-content: space-around; font-size: 0.9rem;
        }
        .money { color: #f1c40f; font-weight: bold; font-size: 1.1rem; }

        /* --- ARENA --- */
        .arena {
            height: 190px; display: flex; justify-content: center; align-items: center;
            position: relative; margin-top: 10px;
        }
        #face {
            font-size: 100px; cursor: pointer; transition: transform 0.05s; z-index: 10;
            filter: drop-shadow(0 0 20px rgba(0, 255, 255, 0.3));
        }
        #face:active { transform: scale(0.9); }
        #weapon-anim { position: absolute; font-size: 80px; opacity: 0; pointer-events: none; z-index: 11; }
        .smash-anim { transform: scale(1.2) rotate(-45deg); opacity: 1 !important; left: 55%; top: 20%; transition: all 0.1s; }
        .particle {
            position: absolute; pointer-events: none; background: #00ffff;
            box-shadow: 0 0 5px #00ffff; width: 6px; height: 6px; border-radius: 50%;
            z-index: 99; animation: fly 0.6s linear forwards;
        }
        @keyframes fly { 0% { opacity: 1; } 100% { transform: translate(var(--tx), var(--ty)); opacity: 0; } }
        .hit { color: #ff00ff; transform: rotate(15deg) scale(0.95); }
        .dead { filter: grayscale(100%) brightness(0.5); opacity: 0.7; transform: rotate(180deg); pointer-events: none; }

        /* --- HP BAR --- */
        .bar-container {
            width: 90%; height: 15px; border: 1px solid #ff00ff; margin: 5px auto; background: rgba(0,0,0,0.7);
        }
        .bar-fill { height: 100%; background: linear-gradient(90deg, #ff00ff, #00ffff); width: 100%; transition: width 0.1s; }

        /* --- SHOP/CASINO UI --- */
        .shop-area {
            margin-top: 5px; padding-top: 5px; background: rgba(10, 10, 15, 0.95);
            border-top: 2px solid #00ffff; box-shadow: 0 -5px 20px rgba(0, 255, 255, 0.2);
            height: 400px; overflow-y: auto;
        }
        .tab-buttons { display: flex; justify-content: center; gap: 5px; margin-bottom: 10px; padding: 0 5px; }
        .tab-btn {
            background: rgba(0,0,0,0.5); border: 1px solid #555; color: #888;
            padding: 8px; cursor: pointer; font-family: sans-serif; text-transform: uppercase;
            font-size: 0.75rem; flex: 1; transition: 0.3s;
        }
        .tab-btn.active { background: rgba(0, 255, 255, 0.1); color: #00ffff; border-color: #00ffff; font-weight: bold; }

        .shop-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; padding: 0 10px; }
        .shop-btn {
            background: linear-gradient(135deg, #14141e, #0a0a14); color: #aaa;
            border: 1px solid #333; padding: 8px; cursor: pointer; display: flex;
            align-items: center; gap: 8px; text-align: left; position: relative;
        }
        .shop-btn.owned { border-color: #f1c40f; color: #ddd; }
        .shop-btn.active { border-color: #00ffff; color: white; box-shadow: 0 0 5px #00ffff; }
        .shop-btn h4 { margin: 0; font-size: 0.75rem; }
        .shop-btn small { font-size: 0.65rem; color: #00ffff; }
        .count-badge {
            position: absolute; top: 2px; right: 2px; background: #ff00ff; color: white;
            width: 18px; height: 18px; font-size: 0.6rem; display: flex; align-items: center; justify-content: center;
        }

        /* --- CASINO COMPONENTS --- */
        .casino-box {
            background: rgba(0,0,0,0.3); border: 1px solid #444; padding: 10px;
            margin-bottom: 15px; width: 95%; margin-left: auto; margin-right: auto;
        }
        .casino-title { color: gold; margin: 0 0 5px 0; font-size: 0.9rem; text-transform: uppercase; }
        .bet-input { background: #111; border: 1px solid #555; color: white; width: 70px; text-align: center; }
        .casino-btn { background: #333; border: 1px solid white; color: white; padding: 5px 10px; cursor: pointer; margin: 2px; }
        
        /* Roulette Wheel */
        .roulette-wrapper { position: relative; width: 100px; height: 100px; margin: 10px auto; }
        .roulette-wheel {
            width: 100%; height: 100%; border-radius: 50%; border: 4px solid white;
            /* Green: 0-20deg, Red: 20-200deg, Black: 200-360deg */
            background: conic-gradient(#2ed573 0deg 20deg, #e74c3c 20deg 200deg, #222 200deg 360deg);
            transition: transform 3s cubic-bezier(0.1, 0.7, 0.1, 1);
            transform: rotate(0deg);
        }
        .roulette-arrow {
            width: 0; height: 0; border-left: 8px solid transparent; border-right: 8px solid transparent;
            border-top: 12px solid gold; position: absolute; top: -5px; left: 42px; z-index: 5;
        }

        /* Blackjack */
        .bj-table { background: #004400; padding: 10px; border-radius: 5px; border: 2px solid #555; }
        .cards-area { display: flex; justify-content: center; gap: 5px; margin: 5px 0; min-height: 40px; }
        .bj-card {
            background: white; color: black; padding: 2px 5px; border-radius: 3px; font-weight: bold;
            width: 30px; height: 40px; display: flex; align-items: center; justify-content: center;
            font-size: 0.8rem; border: 1px solid #aaa;
        }
        .bj-controls { margin-top: 5px; }
        .bj-score { color: white; font-size: 0.8rem; margin-bottom: 5px; }

        /* Animations */
        .coin-container { width: 50px; height: 50px; margin: 10px auto; perspective: 600px; }
        .coin { width: 100%; height: 100%; transform-style: preserve-3d; transition: transform 1s ease-out; }
        .coin-side {
            position: absolute; width: 100%; height: 100%; border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
            backface-visibility: hidden; border: 2px solid gold;
        }
        .heads { background: gold; color: black; }
        .tails { background: orange; color: white; transform: rotateY(180deg); }

        .slot-machine { display: flex; justify-content: center; gap: 5px; margin: 10px 0; background: #222; padding: 5px; }
        .reel { width: 30px; height: 40px; background: white; color: black; line-height: 40px; border: 1px solid #555; }
        .spinning { animation: spin 0.1s infinite linear; color: transparent; text-shadow: 0 0 5px black; }
        @keyframes spin { 0% { transform: translateY(-2px); } 50% { transform: translateY(2px); } 100% { transform: translateY(-2px); } }

        #msg { min-height: 20px; color: #00ffff; margin: 5px 0; font-weight: bold; font-size: 0.9rem;}
        #reset-btn {
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
            padding: 15px 40px; font-size: 1.2rem;
            background: linear-gradient(90deg, #00b894, #00cec9); border: 2px solid #00ff00;
            color: black; font-weight: bold; cursor: pointer; z-index: 20;
        }
        .hidden { display: none; }
    </style>
</head>
<body>

    <div id="save-notify">üíæ SAVED</div>

    <h1>Z' D√ñV <span class="level-badge" id="lvl-badge">LVL 1</span></h1>
    
    <div class="stats-bar">
        <span>HP: <b id="hp-val">100</b></span>
        <span class="money"><span id="money-val">0</span> ‚Ç¨</span>
    </div>

    <div class="bar-container"><div id="health" class="bar-fill"></div></div>
    
    <p id="msg">Dein Imperium wartet!</p>

    <div class="arena">
        <div id="weapon-anim">üëä</div>
        <div id="face" onclick="manualAttack(event)">üë®‚Äçü¶≤</div>
        <button id="reset-btn" class="hidden" onclick="nextLevel()">N√ÑCHSTES LEVEL >>></button>
    </div>

    <div class="shop-area">
        <div class="tab-buttons">
            <button class="tab-btn active" onclick="showTab('weapons')">‚öîÔ∏è Waffen</button>
            <button class="tab-btn" onclick="showTab('staff')">üë• Crew</button>
            <button class="tab-btn" onclick="showTab('casino')" style="color: gold; border-color: gold;">üé∞ Casino</button>
        </div>

        <div id="tab-weapons" class="shop-grid">
            <button id="w-fist" class="shop-btn active" onclick="equip('fist')"><span class="icon">üëä</span><div><h4>Faust</h4><small>Gratis</small></div></button>
            <button id="w-slipper" class="shop-btn" onclick="buyWeapon('slipper', 50)"><span class="icon">ü©¥</span><div><h4>Terlik v2</h4><small>50 ‚Ç¨</small></div></button>
            <button id="w-pan" class="shop-btn" onclick="buyWeapon('pan', 250)"><span class="icon">üç≥</span><div><h4>Pfanne</h4><small>250 ‚Ç¨</small></div></button>
            <button id="w-hammer" class="shop-btn" onclick="buyWeapon('hammer', 600)"><span class="icon">üî®</span><div><h4>Hammer</h4><small>600 ‚Ç¨</small></div></button>
            <button id="w-bat" class="shop-btn" onclick="buyWeapon('bat', 1500)"><span class="icon">üèè</span><div><h4>Keule</h4><small>1500 ‚Ç¨</small></div></button>
            <button id="w-fart" class="shop-btn" onclick="buyWeapon('fart', 6868)"><span class="icon">‚ò£Ô∏è</span><div><h4>Atom-D√∂v</h4><small>6868 ‚Ç¨</small></div></button>
        </div>

        <div id="tab-staff" class="shop-grid hidden">
            <button class="shop-btn" onclick="hireStaff('Champ', 100)"><span class="icon">üß¢</span><div><h4>Champ</h4><small>100 ‚Ç¨</small></div><div id="cnt-Champ" class="count-badge hidden">0</div></button>
            <button class="shop-btn" onclick="hireStaff('Lion', 500)"><span class="icon">üï∂Ô∏è</span><div><h4>Lion</h4><small>500 ‚Ç¨</small></div><div id="cnt-Lion" class="count-badge hidden">0</div></button>
            <button class="shop-btn" onclick="hireStaff('Haji Han', 2000)"><span class="icon">üòé</span><div><h4>Haji Han</h4><small>2k ‚Ç¨</small></div><div id="cnt-Haji Han" class="count-badge hidden">0</div></button>
        </div>

        <div id="tab-casino" class="hidden">
            
            <div class="casino-box">
                <h4 class="casino-title">üÉè BLACKJACK (3:2)</h4>
                <div class="bj-table">
                    <div class="bj-score">Oguz: <span id="bj-dealer-score">0</span></div>
                    <div id="bj-dealer-cards" class="cards-area"></div>
                    <hr style="border-color:#444">
                    <div class="bj-score">Du: <span id="bj-player-score">0</span></div>
                    <div id="bj-player-cards" class="cards-area"></div>
                </div>
                <div style="margin-top:5px">
                    <input type="number" id="bet-bj" class="bet-input" placeholder="‚Ç¨" value="100">
                    <button id="btn-bj-start" class="casino-btn" onclick="startBlackjack()">START</button>
                    <span id="bj-actions" class="hidden">
                        <button class="casino-btn" style="background:#2ed573; color:black" onclick="hitBj()">HIT</button>
                        <button class="casino-btn" style="background:#e74c3c; color:white" onclick="standBj()">STAND</button>
                    </span>
                </div>
            </div>

            <div class="casino-box">
                <h4 class="casino-title">üé≤ ROULETTE</h4>
                <div class="roulette-wrapper">
                    <div class="roulette-arrow"></div>
                    <div id="wheel" class="roulette-wheel"></div>
                </div>
                <input type="number" id="bet-roulette" class="bet-input" placeholder="‚Ç¨">
                <div style="margin-top:5px;">
                    <button class="casino-btn" style="color:#e74c3c; border-color:#e74c3c" onclick="spinRoulette('red')">ROT (x2)</button>
                    <button class="casino-btn" style="color:#aaa; border-color:#aaa" onclick="spinRoulette('black')">SCHWARZ (x2)</button>
                    <button class="casino-btn" style="color:#2ed573; border-color:#2ed573" onclick="spinRoulette('green')">GR√úN (x14)</button>
                </div>
            </div>

            <div class="casino-box">
                <h4 class="casino-title">üü° YAZI TURA (x2)</h4>
                <div class="coin-container">
                    <div id="coin" class="coin">
                        <div class="coin-side heads">Y</div>
                        <div class="coin-side tails">T</div>
                    </div>
                </div>
                <input type="number" id="bet-coin" class="bet-input" placeholder="‚Ç¨">
                <button class="casino-btn" onclick="spinCoin()">WERFEN</button>
            </div>

            <div class="casino-box">
                <h4 class="casino-title">üé∞ SLOTS</h4>
                <div class="slot-machine">
                    <div id="reel1" class="reel">üëä</div>
                    <div id="reel2" class="reel">üçí</div>
                    <div id="reel3" class="reel">üíé</div>
                </div>
                <small>100 ‚Ç¨</small> <button class="casino-btn" onclick="spinSlots()">DREHEN</button>
            </div>

        </div>
    </div>

    <script>
        // --- SOUNDS ---
        const sounds = {
            hit: new Audio('hit.m4a'), buy: new Audio('buy.mp3'), win: new Audio('win.mp3')
        };
        sounds.hit.volume = 0.6;

        function playSound(type) { try { sounds[type].cloneNode().play().catch(e=>{}); } catch(e){} }
        document.addEventListener('dblclick', function(event) { event.preventDefault(); }, { passive: false });

        // --- GAME STATE ---
        let state = {
            level: 1, maxHp: 100, hp: 100, money: 0,
            inventory: ['fist'], currentWeapon: 'fist',
            staff: { 'Champ': 0, 'Lion': 0, 'Haji Han': 0 }
        };
        let isDead = false;

        const weapons = {
            'fist': { dmg: [5,9], icon: 'üëä', name: 'Faust' },
            'slipper': { dmg: [15,25], icon: 'ü©¥', name: 'Terlik' },
            'pan': { dmg: [35,55], icon: 'üç≥', name: 'Pfanne' },
            'hammer': { dmg: [70,100], icon: 'üî®', name: 'Hammer' },
            'bat': { dmg: [150,250], icon: 'üèè', name: 'Keule' },
            'fart': { dmg: [500,999], icon: '‚ò£Ô∏è', name: 'Atom-D√∂v' }
        };
        const staffData = { 'Champ':{dps:1,name:"Champ"}, 'Lion':{dps:5,name:"Lion"}, 'Haji Han':{dps:25,name:"Haji Han"} };

        const face = document.getElementById('face');
        const hpBar = document.getElementById('health');
        const hpVal = document.getElementById('hp-val');
        const moneyEl = document.getElementById('money-val');
        const msg = document.getElementById('msg');
        const weaponAnim = document.getElementById('weapon-anim');
        const resetBtn = document.getElementById('reset-btn');
        const lvlBadge = document.getElementById('lvl-badge');
        const saveNotify = document.getElementById('save-notify');

        // --- INIT ---
        loadGame(); updateUI(); updateShopUI();
        setInterval(autoAttack, 1000); setInterval(saveGame, 5000);

        // ================= BLACKJACK LOGIC =================
        let bjDeck = [], bjPlayerHand = [], bjDealerHand = [], bjBet = 0, bjActive = false;

        function startBlackjack() {
            if(bjActive) return;
            let bet = parseInt(document.getElementById('bet-bj').value);
            if(isNaN(bet) || bet <= 0) return msg.innerText = "Einsatz?";
            if(bet > state.money) return msg.innerText = "Zu arm!";
            
            state.money -= bet; bjBet = bet; updateUI();
            
            // Deck erstellen (vereinfacht, unendlich)
            bjDeck = [2,3,4,5,6,7,8,9,10,10,10,10,11]; 
            bjPlayerHand = [drawCard(), drawCard()];
            bjDealerHand = [drawCard(), drawCard()];
            
            bjActive = true;
            document.getElementById('btn-bj-start').classList.add('hidden');
            document.getElementById('bj-actions').classList.remove('hidden');
            document.getElementById('bet-bj').disabled = true;
            
            updateBjUI(false); // Dealer Karte noch verdeckt
            
            // Check instant Blackjack
            if(calcBj(bjPlayerHand) === 21) { standBj(); }
        }

        function drawCard() { return bjDeck[Math.floor(Math.random()*bjDeck.length)]; }

        function calcBj(hand) {
            let sum = hand.reduce((a,b)=>a+b, 0);
            let aces = hand.filter(c=>c===11).length;
            while(sum > 21 && aces > 0) { sum -= 10; aces--; }
            return sum;
        }

        function updateBjUI(revealDealer) {
            // Player UI
            let pDiv = document.getElementById('bj-player-cards');
            pDiv.innerHTML = "";
            bjPlayerHand.forEach(c => { pDiv.innerHTML += `<div class='bj-card'>${c===11?'A':c}</div>`; });
            document.getElementById('bj-player-score').innerText = calcBj(bjPlayerHand);

            // Dealer UI
            let dDiv = document.getElementById('bj-dealer-cards');
            dDiv.innerHTML = "";
            if(revealDealer) {
                bjDealerHand.forEach(c => { dDiv.innerHTML += `<div class='bj-card'>${c===11?'A':c}</div>`; });
                document.getElementById('bj-dealer-score').innerText = calcBj(bjDealerHand);
            } else {
                dDiv.innerHTML += `<div class='bj-card'>${bjDealerHand[0]===11?'A':bjDealerHand[0]}</div>`;
                dDiv.innerHTML += `<div class='bj-card' style='background:#333; color:#333'>?</div>`;
                document.getElementById('bj-dealer-score').innerText = "?";
            }
        }

        function hitBj() {
            if(!bjActive) return;
            bjPlayerHand.push(drawCard());
            updateBjUI(false);
            if(calcBj(bjPlayerHand) > 21) endBj(false);
        }

        function standBj() {
            if(!bjActive) return;
            updateBjUI(true); // Dealer aufdecken
            let dScore = calcBj(bjDealerHand);
            
            // Dealer zieht bis 17
            let drawLoop = setInterval(() => {
                dScore = calcBj(bjDealerHand);
                if(dScore < 17) {
                    bjDealerHand.push(drawCard());
                    updateBjUI(true);
                } else {
                    clearInterval(drawLoop);
                    determineBjWinner();
                }
            }, 800);
        }

        function determineBjWinner() {
            let p = calcBj(bjPlayerHand);
            let d = calcBj(bjDealerHand);
            
            if(d > 21 || p > d) endBj(true);
            else if(p === d) endBj('tie');
            else endBj(false);
        }

        function endBj(result) {
            bjActive = false;
            if(result === true) {
                let win = bjBet * 2;
                if(calcBj(bjPlayerHand) === 21 && bjPlayerHand.length === 2) win = Math.floor(bjBet * 2.5); // Blackjack 3:2
                state.money += win;
                msg.innerText = "GEWONNEN! +" + win; playSound('buy');
            } else if (result === 'tie') {
                state.money += bjBet;
                msg.innerText = "UNENTSCHIEDEN!";
            } else {
                msg.innerText = "DEALER GEWINNT!";
            }
            document.getElementById('btn-bj-start').classList.remove('hidden');
            document.getElementById('bj-actions').classList.add('hidden');
            document.getElementById('bet-bj').disabled = false;
            updateUI();
        }

        // ================= ROULETTE LOGIC (FIXED) =================
        let wheelSpinning = false;
        function spinRoulette(color) {
            if(wheelSpinning) return;
            let bet = parseInt(document.getElementById('bet-roulette').value);
            if(isNaN(bet) || bet <= 0) return msg.innerText = "Einsatz?";
            if(bet > state.money) return msg.innerText = "Zu arm!";
            state.money -= bet; updateUI(); wheelSpinning = true;

            const wheel = document.getElementById('wheel');
            
            // Rotation zur√ºcksetzen (Trick)
            wheel.style.transition = 'none';
            wheel.style.transform = 'rotate(0deg)';
            wheel.offsetHeight; // Trigger reflow

            // Zuf√§lliges Ergebnis (0-360 Grad)
            let finalRot = Math.floor(Math.random() * 360);
            
            // Extra Drehungen hinzuf√ºgen f√ºr Animation
            let spinAmount = (360 * 5) + (360 - finalRot); // 360-finalRot weil Pfeil oben ist
            
            wheel.style.transition = "transform 3s cubic-bezier(0.1, 0.7, 0.1, 1)";
            wheel.style.transform = `rotate(${spinAmount}deg)`;

            setTimeout(() => {
                // Ergebnis berechnen
                // Gradient: Green 0-20, Red 20-200, Black 200-360
                // Da wir gegen den Uhrzeigersinn lesen, wenn das Rad CW dreht:
                let resultColor = "";
                if(finalRot >= 0 && finalRot < 20) resultColor = 'green';
                else if(finalRot >= 20 && finalRot < 200) resultColor = 'red';
                else resultColor = 'black';

                if(color === resultColor) {
                    let win = color === 'green' ? bet * 14 : bet * 2;
                    state.money += win;
                    msg.innerText = resultColor.toUpperCase() + "! GEWONNEN! +" + win;
                    playSound('buy');
                } else {
                    msg.innerText = "Es kam " + resultColor.toUpperCase();
                }
                updateUI();
                wheelSpinning = false;
            }, 3000);
        }

        // --- OTHER CASINO ---
        function spinCoin() {
            let bet = parseInt(document.getElementById('bet-coin').value);
            if (isNaN(bet) || bet <= 0) return msg.innerText = "Einsatz?";
            if (bet > state.money) return msg.innerText = "Zu arm!";
            state.money -= bet; updateUI();
            
            const coin = document.getElementById('coin');
            coin.style.animation = 'none'; coin.offsetHeight; 
            
            let isHeads = Math.random() < 0.5;
            let rotate = 1800 + (isHeads ? 0 : 180); 
            
            coin.style.transition = "transform 1.5s ease-out";
            coin.style.transform = `rotateY(${rotate}deg)`;
            
            setTimeout(() => {
                if (isHeads) { 
                    state.money += bet * 2; msg.innerText = "YAZI! +" + bet*2; msg.style.color="#2ed573"; playSound('buy');
                } else { msg.innerText = "TURA!"; msg.style.color="red"; }
                updateUI();
                setTimeout(() => { coin.style.transition = "none"; coin.style.transform = "rotateY(0deg)"; }, 1000);
            }, 1500);
        }

        function spinSlots() {
            if (state.money < 100) return msg.innerText = "Brauchst 100 ‚Ç¨!";
            state.money -= 100; updateUI();
            const r1 = document.getElementById('reel1'), r2 = document.getElementById('reel2'), r3 = document.getElementById('reel3');
            r1.classList.add('spinning'); r2.classList.add('spinning'); r3.classList.add('spinning');
            const sym = ["üëä", "ü©¥", "üë®‚Äçü¶≤", "üçí", "üíé"];
            
            setTimeout(() => { r1.classList.remove('spinning'); r1.innerText = sym[Math.floor(Math.random()*5)]; }, 500);
            setTimeout(() => { r2.classList.remove('spinning'); r2.innerText = sym[Math.floor(Math.random()*5)]; }, 1000);
            setTimeout(() => {
                r3.classList.remove('spinning');
                let s3 = sym[Math.floor(Math.random()*5)]; r3.innerText = s3;
                let s1 = r1.innerText, s2 = r2.innerText;
                if (s1==s3 && s2==s3) { state.money += 1000; msg.innerText="JACKPOT!"; playSound('win'); }
                else if (s1==s2 || s2==s3 || s1==s3) { state.money += 200; msg.innerText="Kleiner Gewinn!"; playSound('buy'); }
                else msg.innerText="Niete!";
                updateUI();
            }, 1500);
        }

        // --- GAME CORE ---
        function manualAttack(e) { if (!isDead) attackLogic(true, e.clientX, e.clientY); }
        function autoAttack() {
            if (isDead) return;
            let dps = (state.staff['Champ']*1) + (state.staff['Lion']*5) + (state.staff['Haji Han']*25);
            if (dps > 0) { const r = face.getBoundingClientRect(); attackLogic(false, r.left+r.width/2, r.top+r.height/2, dps); }
        }
        function attackLogic(isManual, x, y, autoDmg=0) {
            let dmg = 0; let w = weapons[state.currentWeapon];
            if (isManual) {
                playSound('hit');
                dmg = Math.floor(Math.random() * (w.dmg[1]-w.dmg[0]+1)) + w.dmg[0];
                if (Math.random() < 0.15) { dmg *= 2; spawnParticles(x, y, 10, '#ff00ff'); } 
                else { spawnParticles(x, y, 4, '#00ffff'); }
                animateWeapon(w.icon);
                state.money += Math.floor(Math.random()*3)+state.level;
            } else { dmg = autoDmg; spawnParticles(x, y, 1, '#00ff00'); }
            state.hp -= dmg; if(state.hp<0) state.hp=0;
            updateUI(); updateFace();
            if(state.hp<=0) kill();
        }
        function animateWeapon(icon) {
            weaponAnim.innerText = icon; weaponAnim.style.opacity = '1'; weaponAnim.classList.add('smash-anim');
            face.classList.add('hit');
            setTimeout(() => { face.classList.remove('hit'); weaponAnim.classList.remove('smash-anim'); weaponAnim.style.opacity = '0'; }, 100);
        }
        function updateFace() {
            let p = (state.hp/state.maxHp)*100;
            if(state.hp>0) { if(p<30) face.innerText="ü§¢"; else if(p<60) face.innerText="ü§ï"; else face.innerText="üò†"; }
        }
        function kill() {
            isDead = true; playSound('win');
            face.innerText = "üòµ"; face.classList.add('dead');
            state.money += 50 * state.level;
            msg.innerText = "K.O.! + " + (50*state.level) + " ‚Ç¨";
            resetBtn.classList.remove('hidden'); updateUI(); saveGame();
        }
        function nextLevel() {
            state.level++; state.maxHp = Math.floor(state.maxHp*1.4); state.hp = state.maxHp;
            isDead = false; face.innerText = "üë®‚Äçü¶≤"; face.classList.remove('dead');
            resetBtn.classList.add('hidden'); msg.innerText = "Oguz Rebooted!";
            updateUI(); saveGame();
        }
        function buyWeapon(k, p) {
            if(state.inventory.includes(k)) { equip(k); return; }
            if(state.money >= p) { state.money -= p; state.inventory.push(k); equip(k); playSound('buy'); }
            updateUI(); updateShopUI();
        }
        function hireStaff(t, p) {
            let cost = Math.floor(p * Math.pow(1.2, state.staff[t]));
            if(state.money >= cost) { state.money -= cost; state.staff[t]++; playSound('buy'); }
            updateUI(); updateShopUI();
        }
        function equip(k) { state.currentWeapon = k; updateShopUI(); }
        function showTab(t) {
            document.getElementById('tab-weapons').classList.add('hidden');
            document.getElementById('tab-staff').classList.add('hidden');
            document.getElementById('tab-casino').classList.add('hidden');
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            document.getElementById('tab-'+t).classList.remove('hidden');
            event.target.classList.add('active');
        }
        function updateUI() {
            moneyEl.innerText = state.money;
            hpBar.style.width = (state.hp/state.maxHp*100) + "%";
            hpVal.innerText = state.hp + "/" + state.maxHp;
            lvlBadge.innerText = "LVL " + state.level;
            let r = Math.max(10 - state.level, 0); let b = Math.min(20 + (state.level*2), 60);
            document.body.style.backgroundColor = `rgb(${r}, ${r}, ${b})`;
        }
        function updateShopUI() {
            document.querySelectorAll('.shop-btn').forEach(b => { b.classList.remove('active'); b.classList.remove('owned'); });
            state.inventory.forEach(k => {
                let b = document.getElementById('w-'+k);
                if(b) { b.classList.add('owned'); b.querySelector('small').innerText = "BESITZ"; }
            });
            let ab = document.getElementById('w-'+state.currentWeapon);
            if(ab) { ab.classList.add('active'); ab.querySelector('small').innerText = "AKTIV"; }
            for(let t in state.staff) {
                let b = document.getElementById('cnt-'+t);
                if(state.staff[t]>0) { b.innerText = state.staff[t]; b.classList.remove('hidden'); }
            }
        }
        function spawnParticles(x, y, n, c) {
            for(let i=0; i<n; i++) {
                let p = document.createElement('div'); p.classList.add('particle');
                p.style.background = c; p.style.left=x+'px'; p.style.top=y+'px';
                let tx = (Math.random()-0.5)*150; let ty = (Math.random()-0.5)*150;
                p.style.setProperty('--tx', tx+'px'); p.style.setProperty('--ty', ty+'px');
                document.body.appendChild(p); setTimeout(()=>p.remove(), 600);
            }
        }
        function saveGame() { localStorage.setItem('zDovUlt', JSON.stringify(state)); saveNotify.style.opacity=1; setTimeout(()=>saveNotify.style.opacity=0, 1000); }
        function loadGame() {
            let s = localStorage.getItem('zDovUlt');
            if(s) try { state = { ...state, ...JSON.parse(s) }; if(state.hp<=0) state.hp=1; } catch(e){}
        }
    </script>
</body>
</html>
